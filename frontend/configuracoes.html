<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIRO.AI - Configurações</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <style>
        .config-header { display: flex; flex-wrap: wrap; gap: 20px; align-items: flex-start; margin-bottom: 30px; }
        .config-header .input-group { flex-grow: 1; flex-basis: 300px; min-width: 250px; }
        .description-box { flex-grow: 2; flex-basis: 400px; background-color: var(--cinza-fundo ); border: 1px solid var(--borda-suave); border-radius: 8px; padding: 15px 20px; min-height: 85px; color: var(--texto-secundario); font-size: 0.95em; display: flex; align-items: center; }
        .description-box p { margin: 0; }
        .keywords-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .keyword-item { display: flex; align-items: center; justify-content: space-between; background-color: var(--cinza-fundo); padding: 12px 18px; border-radius: 8px; border: 1px solid var(--borda-suave); }
        .keyword-item label { font-weight: 500; color: var(--texto-principal); }
        .keyword-item input { width: 70px; text-align: center; padding: 8px; border-radius: 5px; border: 1px solid #ced4da; }
        .action-buttons { display: flex; gap: 15px; margin-top: 30px; justify-content: flex-end; }
        .action-buttons .btn-analyze { width: auto; flex-grow: 0; display: flex; align-items: center; gap: 8px; }
        .btn-secondary { background: #6c757d; }
        .btn-secondary:hover { background: #5a6268; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="logo-container"><img src="images/logo.png" alt="Logo AIRO.AI" class="logo"><h1>Airo.ai</h1></div>
        <nav class="main-nav"><a href="dashboard.html">Dashboard</a><a href="ranking.html">Ranking</a><a href="vagas.html">Vagas Abertas</a><a href="configuracoes.html">Configurações</a><a href="login.html" id="logout-link">Sair</a></nav>
    </header>
    <main class="main-container">
        <section class="main-card">
            <h2>Configuração de Palavras-Chave</h2>
            <div class="config-header">
                <div class="input-group">
                    <label for="profissao-select">Selecione a Profissão:</label>
                    <select id="profissao-select"><option value="">-- Carregando... --</option></select>
                </div>
                <div class="description-box">
                    <p id="profissao-descricao">Selecione uma profissão para ver um resumo sobre ela.</p>
                </div>
            </div>
            <div id="keywords-container" class="keywords-grid" style="display: none;"></div>
            <div class="action-buttons">
                <button id="btn-restaurar-padroes" class="btn-analyze btn-secondary" style="display: none;"><i class="fas fa-undo"></i> Restaurar Padrões</button>
                <button id="btn-salvar-config" class="btn-analyze" style="display: none;"><i class="fas fa-save"></i> Salvar Alterações</button>
            </div>
        </section>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            fetch('http://127.0.0.1:5000/status', { method: 'GET', credentials: 'include' }  ).then(response => { if (!response.ok) { window.location.href = 'login.html'; } return response.json(); }).then(data => { if (data.status !== 'logado') { window.location.href = 'login.html'; } }).catch(() => { window.location.href = 'login.html'; });
            const API_URL = 'http://127.0.0.1:5000';
            const profissaoSelect = document.getElementById('profissao-select' );
            const keywordsContainer = document.getElementById('keywords-container');
            const descricaoP = document.getElementById('profissao-descricao');
            const btnSalvar = document.getElementById('btn-salvar-config');
            const btnRestaurar = document.getElementById('btn-restaurar-padroes');
            let configData = {};
            function exibirKeywords(profissao) {
                keywordsContainer.innerHTML = '';
                if (profissao) {
                    const keywords = configData.keywords[profissao];
                    descricaoP.textContent = configData.descriptions[profissao];
                    for (const palavra in keywords) { keywordsContainer.innerHTML += `<div class="keyword-item"><label>${palavra}</label><input type="number" class="keyword-input" data-profissao="${profissao}" data-palavra="${palavra}" value="${keywords[palavra]}"></div>`; }
                    keywordsContainer.style.display = 'grid';
                    btnSalvar.style.display = 'flex';
                    btnRestaurar.style.display = 'flex';
                } else {
                    descricaoP.textContent = 'Selecione uma profissão para ver um resumo sobre ela.';
                    keywordsContainer.style.display = 'none';
                    btnSalvar.style.display = 'none';
                    btnRestaurar.style.display = 'none';
                }
            }
            fetch(`${API_URL}/configuracoes`, { credentials: 'include' }).then(res => res.json()).then(data => {
                configData = data;
                profissaoSelect.innerHTML = '<option value="">-- Selecione uma profissão --</option>';
                Object.keys(data.keywords).forEach(p => { const nomeAmigavel = p.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()); profissaoSelect.add(new Option(nomeAmigavel, p)); });
            });
            profissaoSelect.addEventListener('change', function() { exibirKeywords(this.value); });
            btnSalvar.addEventListener('click', function() {
                document.querySelectorAll('.keyword-input').forEach(input => { configData.keywords[input.dataset.profissao][input.dataset.palavra] = parseInt(input.value, 10); });
                fetch(`${API_URL}/configuracoes`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(configData.keywords), credentials: 'include' }).then(res => res.json()).then(data => alert(data.mensagem));
            });
            btnRestaurar.addEventListener('click', function() {
                if (confirm('Tem certeza que deseja restaurar TODAS as configurações para os valores padrão?')) {
                    fetch(`${API_URL}/configuracoes/padrao`, { credentials: 'include' }).then(res => res.json()).then(dadosPadrao => {
                        fetch(`${API_URL}/configuracoes`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(dadosPadrao.keywords), credentials: 'include' }).then(res => res.json()).then(data => {
                            alert(data.mensagem + ' As configurações foram restauradas para o padrão.');
                            configData = dadosPadrao;
                            exibirKeywords(profissaoSelect.value);
                        });
                    });
                }
            });
            document.getElementById('logout-link').addEventListener('click', function(e) { e.preventDefault(); fetch(`${API_URL}/logout`, { method: 'POST', credentials: 'include' }).then(() => window.location.href = 'login.html'); });
        });
    </script>
</body>
</html>
